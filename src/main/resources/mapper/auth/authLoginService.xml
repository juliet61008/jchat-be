<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jchat.auth.mapper.AuthLoginMapper">
    <sql id="selectTboUser">
        user_no                     as user_no
        , id                        as id
        , name                      as name
        , birth                     as birth
        , email_id || '@' || email_domain  as email
    </sql>

    <select id="searchLoginInfoById" resultType="com.jchat.auth.dto.LoginInfoByIdResDto">
        select /* [authLoginService.searchLoginInfoById] 아이디로 로그인정보 조회 [juliet61008/25.12.09]*/
            user_no
            , password
        from
            tbo_user
        where
            id = #{id}
        and secn_yn = 'N'
    </select>

    <select id="searchUserInfoByUserNo" resultType="com.jchat.auth.dto.UserInfoDto">
        /* [authLoginService.searchUserInfoByUserNo] 로그인 인증 조회 [juliet61008/25.12.03]*/
        select
            a1.user_no                     as user_no
            , a1.id                        as id
            , a1.name                      as name
            , a1.birth                     as birth
            , a1.email_id || '@' || email_domain  as email
            , string_agg(b1.role_id::varchar, '|' ORDER BY b1.role_id) as role_id_list
        from
            tbo_user a1
        join
            tbo_user_role b1
        on
            a1.user_no = b1.user_no
        and b1.del_yn = 'N'
        and b1.use_yn = 'Y'
        where
            a1.user_no = #{userNo}
        and a1.secn_yn = 'N'
        group by
            a1.user_no
    </select>
</mapper>